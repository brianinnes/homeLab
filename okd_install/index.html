<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="How to create your own home or office Lab environment to explore Red Hat OpenShift using oVirt and OKD"><meta name=author content="Brian Innes"><link href=https://brianinnes.github.io/homeLab/okd_install/ rel=canonical><link href=../workstation/ rel=prev><link href=../devops/ rel=next><link rel=icon href=../images/BrianLogo.png><meta name=generator content="mkdocs-1.4.2, mkdocs-material-9.0.2"><title>OKD install - Home Lab</title><link rel=stylesheet href=../assets/stylesheets/main.f56500e0.min.css><link rel=stylesheet href=../assets/stylesheets/palette.2505c338.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../css/extra.css><script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=brian data-md-color-primary=brian-blue data-md-color-accent=brian-light-green> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#okd-install class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=.. title="Home Lab" class="md-header__button md-logo" aria-label="Home Lab" data-md-component=logo> <img src=../images/BrianLogo.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Home Lab </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> OKD install </span> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/brianinnes/homeLab title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> homeLab </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=.. title="Home Lab" class="md-nav__button md-logo" aria-label="Home Lab" data-md-component=logo> <img src=../images/BrianLogo.png alt=logo> </a> Home Lab </label> <div class=md-nav__source> <a href=https://github.com/brianinnes/homeLab title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> homeLab </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=.. class=md-nav__link> Home </a> </li> <li class=md-nav__item> <a href=../overview/ class=md-nav__link> Overview </a> </li> <li class=md-nav__item> <a href=../preparation/ class=md-nav__link> Preparing </a> </li> <li class=md-nav__item> <a href=../my-setup/ class=md-nav__link> My setup </a> </li> <li class=md-nav__item> <a href=../ovirt/ class=md-nav__link> oVirt setup </a> </li> <li class=md-nav__item> <a href=../workstation/ class=md-nav__link> Hosted workstation </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> OKD install <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> OKD install </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#preparing-required-information class=md-nav__link> Preparing required information </a> </li> <li class=md-nav__item> <a href=#install-okd class=md-nav__link> Install OKD </a> <nav class=md-nav aria-label="Install OKD"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#download-the-installer class=md-nav__link> Download the installer </a> </li> <li class=md-nav__item> <a href=#create-the-install-config class=md-nav__link> Create the install config </a> </li> <li class=md-nav__item> <a href=#run-the-installer class=md-nav__link> Run the installer </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#connecting-to-the-cluster class=md-nav__link> Connecting to the cluster </a> <nav class=md-nav aria-label="Connecting to the cluster"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#web-ui class=md-nav__link> Web UI </a> </li> <li class=md-nav__item> <a href=#command-lined class=md-nav__link> Command lined </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#post-install-tasks class=md-nav__link> Post install tasks </a> <nav class=md-nav aria-label="Post install tasks"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#adding-an-identity-provider class=md-nav__link> Adding an Identity provider </a> </li> <li class=md-nav__item> <a href=#creating-an-administrator-account class=md-nav__link> Creating an administrator account </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_8 type=checkbox id=__nav_8> <label class=md-nav__link for=__nav_8> Development Environment <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Development Environment" data-md-level=1> <label class=md-nav__title for=__nav_8> <span class="md-nav__icon md-icon"></span> Development Environment </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../devops/ class=md-nav__link> DevOps </a> </li> <li class=md-nav__item> <a href=../devops/objectStorage/ class=md-nav__link> Object Storage </a> </li> <li class=md-nav__item> <a href=../devops/registry/ class=md-nav__link> Container Registry </a> </li> <li class=md-nav__item> <a href=../devops/argocd/ class=md-nav__link> ArgoCD </a> </li> <li class=md-nav__item> <a href=../devops/pipelines/ class=md-nav__link> Pipelines </a> </li> <li class=md-nav__item> <a href=../devops/gitea/ class=md-nav__link> Gitea </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_9 type=checkbox id=__nav_9> <label class=md-nav__link for=__nav_9> Full Stack Development <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Full Stack Development" data-md-level=1> <label class=md-nav__title for=__nav_9> <span class="md-nav__icon md-icon"></span> Full Stack Development </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../full-stack/nuxt3/ class=md-nav__link> Nuxt 3 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../resources/ class=md-nav__link> Resources </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#preparing-required-information class=md-nav__link> Preparing required information </a> </li> <li class=md-nav__item> <a href=#install-okd class=md-nav__link> Install OKD </a> <nav class=md-nav aria-label="Install OKD"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#download-the-installer class=md-nav__link> Download the installer </a> </li> <li class=md-nav__item> <a href=#create-the-install-config class=md-nav__link> Create the install config </a> </li> <li class=md-nav__item> <a href=#run-the-installer class=md-nav__link> Run the installer </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#connecting-to-the-cluster class=md-nav__link> Connecting to the cluster </a> <nav class=md-nav aria-label="Connecting to the cluster"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#web-ui class=md-nav__link> Web UI </a> </li> <li class=md-nav__item> <a href=#command-lined class=md-nav__link> Command lined </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#post-install-tasks class=md-nav__link> Post install tasks </a> <nav class=md-nav aria-label="Post install tasks"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#adding-an-identity-provider class=md-nav__link> Adding an Identity provider </a> </li> <li class=md-nav__item> <a href=#creating-an-administrator-account class=md-nav__link> Creating an administrator account </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=okd-install>OKD Install<a class=headerlink href=#okd-install title="Permanent link">&para;</a></h1> <!--- cSpell:ignore  ovirtmgmt Fzcwo openshift ully ualified omain mkdir kubeadmin kubeconfig htpasswd zxvf --> <p>When you have your oVirt environment up and running you can install OKD.</p> <h2 id=preparing-required-information>Preparing required information<a class=headerlink href=#preparing-required-information title="Permanent link">&para;</a></h2> <p>To help with the installation here is a list of information you will need during the install:</p> <table> <thead> <tr> <th>item</th> <th>description</th> </tr> </thead> <tbody> <tr> <td>Engine FQDN</td> <td>This is the Fully Qualified Domain Name of the virtual engine. This is the value you entered in step 1 in oVirt setup section <a href=../ovirt/#install-the-hosted-engine target=_blank>Install the Hosted Engine</a></td> </tr> <tr> <td>Engine user</td> <td>This should be admin</td> </tr> <tr> <td>Engine password</td> <td>This is the value entered at ovirt install time, and the password you use to access the ovirt admin console</td> </tr> <tr> <td>oVirt Cluster name</td> <td>Should be <strong>Default</strong>. This can be verified in the oVirt Administration console, select <strong>Compute</strong> from the side menu then <strong>Clusters</strong>. By default there is a single cluster defined with <strong>Default</strong> as the name</td> </tr> <tr> <td>Storage Domain</td> <td>Select the storage domain with fast storage, ideally Solid State Disk (SSD) should be used</td> </tr> <tr> <td>Network</td> <td>Select the oVirt network to place the OKD cluster hosts on. By default a single network named <strong>ovirtmgmt</strong> is created at oVirt install</td> </tr> <tr> <td>IP address for the API endpoint for the OKD cluster</td> <td>The IP address on your network you previously allocated for the OKD cluster API Endpoint</td> </tr> <tr> <td>IP address for the Ingress for the OKD cluster</td> <td>The IP address on your network you previously allocated for the OKD Cluster Ingress</td> </tr> <tr> <td>OKD Cluster base domain</td> <td>The base domain your cluster will use for all exposed endpoints - This cannot be changed after installation</td> </tr> <tr> <td>Cluster Name</td> <td>The name for the OKD cluster, this will be prepended to the base domain to form the URLs for application and API endpoints. (e.g. <code>api.&lt;cluster name&gt;.&lt;base domain&gt;</code>)</td> </tr> <tr> <td>Enter a valid Red Hat pull secret</td> <td>This is the pull secret to the Red Hat image registries where Open Shift images are stored. You don't need to use a valid pull secret as OKD does not need access to the registries, but providing a valid secret will allow Red Hat applications to be installed on the cluster. The pull secret must pass a validation check. A valid fake secret is <code>{"auths":{"fake":{"auth":"aWQ6cGFzcwo="}}}</code>. If you have a Red Hat account a valid secret can be downloaded from <a href=https://cloud.redhat.com/openshift/install/pull-secret target=_blank>here</a>. Adding a valid pull secret will allow access to licensed Red Hat content, you need to ensure you comply with Red Hat entitlements if providing a valid secret</td> </tr> </tbody> </table> <div class="admonition todo"> <p class=admonition-title>Todo</p> <p>Add details of the required DNS config needed to allow the OKD setup to work</p> </div> <h2 id=install-okd>Install OKD<a class=headerlink href=#install-okd title="Permanent link">&para;</a></h2> <p>Complete the following steps to install OKD on your cluster</p> <h3 id=download-the-installer>Download the installer<a class=headerlink href=#download-the-installer title="Permanent link">&para;</a></h3> <ul> <li>To find the latest version of the OKD installer, visit the <a href=https://github.com/openshift/okd/releases target=_blank>releases</a> page and download the latest openshift-install image for the platform where you plan to run the installer from (this is typically your local laptop, but could be a virtual machine you run on the ovirt cluster).</li> </ul> <p>Alternatively you can download one of the <a href=https://amd64.origin.releases.ci.openshift.org target=_blank>nightly builds</a>. These builds contain recent updates and fixes, but aren't an official release, so may contain unresolved issues. Click on a build to get information about the build and also the command to download and unpack the build to your local system</p> <ul> <li>Expand the downloaded archive to allow access to the openshift-install binary, e.g. <code>tar zxvf openshift-install-mac-4.9.0-0.okd-2021-08-03-074139.tar.gz</code></li> </ul> <h3 id=create-the-install-config>Create the install config<a class=headerlink href=#create-the-install-config title="Permanent link">&para;</a></h3> <ul> <li>Open a command or terminal window and switch to the directory containing the openshift-install binary</li> <li> <p>run command <code>./openshift-install create install-config</code>, and enter the values when prompted - these are the values you prepared at the top of this page.</p> <ul> <li>select oVirt as the Platform</li> <li>enter the engine <strong>F</strong>ully <strong>Q</strong>ualified <strong>D</strong>omain <strong>N</strong>ame</li> <li>accept the suggested engine username (admin@internal) by pressing enter</li> <li>enter the engine password</li> <li>accept the default Cluster name, which should be set as <strong>Default</strong> unless you have changed oVirt configuration</li> <li>select the appropriate storage domain to store the OKD cluster host disk images</li> <li>select the Network to use</li> <li>input IP address allocated to OKD cluster API endpoint</li> <li>input IP address allocated to OKD cluster Ingress</li> <li>input the base domain</li> <li>input the cluster name (forms the end of all URLs for cluster apps <code>apps.&lt;cluster name&gt;.&lt;basse domain&gt;</code>)</li> <li>input the pull secret (either a valid Red Hat or the fake one provided above)</li> </ul> </li> </ul> <div class="admonition warning"> <p class=admonition-title>Warning</p> <p>There is a <a href="https://bugzilla.redhat.com/show_bug.cgi?id=1984481" target=_blank>bug</a> in the OVNKubernetes network provider in OKD 4.7. This prevents the install working without manual intervention and prevents the detection of external IP addresses causing the worker Machines being stuck in Provisioning phase. A work around is to use the <strong>OpenShiftSDN</strong> network provider. </p> <p>To do this change the <strong>install-config.yaml</strong> file created in the previous steps and change the <strong>networkType</strong> property from <strong>OVNKubernetes</strong> to <strong>OpenShiftSDN</strong></p> <div class=highlight><pre><span></span><code><span class=nt>networking</span><span class=p>:</span>
<span class=w>    </span><span class=nt>clusterNetwork</span><span class=p>:</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>cidr</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">10.128.0.0/14</span>
<span class=w>        </span><span class="l l-Scalar l-Scalar-Plain">hostPrefix</span><span class="p p-Indicator">:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">23</span>
<span class=w>    </span><span class=nt>machineNetwork</span><span class=p>:</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>cidr</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">10.0.0.0/16</span>
<span class=w>    </span><span class=nt>networkType</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">OpenShiftSDN</span>
<span class=w>    </span><span class=nt>serviceNetwork</span><span class=p>:</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">172.30.0.0/16</span>
</code></pre></div> </div> <div class="admonition warning"> <p class=admonition-title>Warning</p> <p>From OKD 4.8 the default install configuration now defines affinity groups. If you do not have at least 3 physical oVirt hosts then you need to alter the install configuration to <strong>not</strong> enforce the affinity groups.</p> <p>To do this in the <strong>platform</strong> section at the bottom of the <strong>install-config.yaml</strong> file, set the enforcing property to false for the affinity groups:</p> <div class=highlight><pre><span></span><code><span class=nt>platform</span><span class=p>:</span>
<span class=w>    </span><span class=nt>ovirt</span><span class=p>:</span>
<span class=w>        </span><span class=nt>affinityGroups</span><span class=p>:</span>
<span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">AffinityGroup for spreading each compute machine to a different</span>
<span class=w>            </span><span class="l l-Scalar l-Scalar-Plain">host</span>
<span class=w>        </span><span class=nt>enforcing</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">compute</span>
<span class=w>        </span><span class=nt>priority</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">AffinityGroup for spreading each control plane machine to a different</span>
<span class=w>            </span><span class="l l-Scalar l-Scalar-Plain">host</span>
<span class=w>        </span><span class=nt>enforcing</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">controlplane</span>
<span class=w>        </span><span class=nt>priority</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
</code></pre></div> </div> <h3 id=run-the-installer>Run the installer<a class=headerlink href=#run-the-installer title="Permanent link">&para;</a></h3> <div class="admonition note"> <p class=admonition-title>Note</p> <p>The default install will download the required content from the internet. It is assumed that the machine running the <strong>openshift-install</strong> application and the machine hosting <strong>oVirt</strong> and the <strong>OKD</strong> cluster have a good internet connection to be able to download the required content.</p> </div> <ul> <li>create an install directory <code>mkdir install</code></li> <li>copy the configuration into the install directory - don't move it, copy it as it gets deleted during the install, so it is good to have a backup copy. <code>cp install-config.yaml install</code></li> <li>create the cluster with command <code>./openshift-install create cluster --dir=./install --log-level=info</code></li> <li>wait until the setup completes, this can take quite a while, 30-60 minutes is not uncommon</li> <li> <p>when the install completes you will see a message similar to this:</p> <div class=highlight><pre><span></span><code>INFO Install complete!                            
INFO To access the cluster as the system:admin user when using &#39;oc&#39;, run &#39;export KUBECONFIG=/Users/brian/projects/okd/4.7/install/auth/kubeconfig&#39; 
INFO Access the OpenShift web-console here: https://console-openshift-console.apps.okd.lab.home 
INFO Login to the console with user: &quot;kubeadmin&quot;, and password: &quot;xxxxx-xxxxx-xxxxx-xxxxx&quot;
</code></pre></div> </li> </ul> <div class="admonition warning"> <p class=admonition-title>Warning</p> <p>It is important that you keep the install directory after the installation has finished, as if you ever shut your cluster down for a length of time, then the certificates used within the system may expire whilst the system is down. The only way to access the cluster to renew the certificates is with the auth credentials contained within the install directory. You also need the install directory if you want to uninstall the cluster.</p> </div> <div class="admonition info"> <p class=admonition-title>Info</p> <p>If you have a slower network connection it is possible that the install will timeout. You can continue the install process if the install times out. Depending on the place where it timeouts you can continue:</p> <ul> <li>Timeout during bootstrap : <code>./openshift-install wait-for bootstrap-complete</code><ul> <li>once bootstrap completes run command : <code>./openshift-install destroy bootstrap</code> to clean up the bootstrap vm</li> <li>the run the command to wait for the remaining install <code>./openshift-install wait-for install-complete</code></li> </ul> </li> <li>Timeout after bootstrap completes, waiting for cluster to initialize run command : <code>./openshift-install wait-for install-complete</code></li> </ul> </div> <h2 id=connecting-to-the-cluster>Connecting to the cluster<a class=headerlink href=#connecting-to-the-cluster title="Permanent link">&para;</a></h2> <p>Now your cluster has been installed you want to be able to access it. There are 2 ways to access it:</p> <ul> <li>Web Console</li> <li>Command line</li> </ul> <h3 id=web-ui>Web UI<a class=headerlink href=#web-ui title="Permanent link">&para;</a></h3> <p>After installation your cluster web console should be accessible at the URL displayed when the openshift-install command completes. The URL is of the form <code>https://console-openshift-console.apps.&lt;cluster name&gt;.&lt;base domain&gt;</code>.</p> <p>You can use the kubeadmin command, with the password displayed when the openshift-install command completed. This is the temporary cluster admin account. You should add an identity provider and create your own admin account. Instructions to complete this task are provided below.</p> <h3 id=command-lined>Command lined<a class=headerlink href=#command-lined title="Permanent link">&para;</a></h3> <p>You can access the cluster from the command line using the <strong>oc</strong> command line tool. Please ensure the version of OC is up to date. The correct version of <strong>oc</strong> for your cluster can be downloaded from the web console. Select the question mark (?) icon next to your user name in the top menu, then select <strong>Command line tools</strong> from the menu. Then you can select the appropriate binary version of the tool for your operating system.</p> <p>Once you have the oc tool install you can connect to the cluster. There are 2 ways to connect to the cluster:</p> <h4 id=connecting-using-the-kubeconfig-file>Connecting using the kubeconfig file<a class=headerlink href=#connecting-using-the-kubeconfig-file title="Permanent link">&para;</a></h4> <p>During installation a kubeconfig file was created. This content needs to be kept safe, as it can be the only way o log in if the cluster has been shutdown for a while and certificates have expired. It also provides an admin login. To use the file set the environment variable KUBECONFIG to point to the config file. The location was provided as part of the openshift-install completion message, such as :</p> <div class=highlight><pre><span></span><code><span class=nb>export</span><span class=w> </span><span class=nv>KUBECONFIG</span><span class=o>=</span>/Users/brian/projects/okd/4.7/install/auth/kubeconfig
</code></pre></div> <p>you can now use the oc command and be connected as an administrator.</p> <h4 id=connect-as-a-specific-user>Connect as a specific user<a class=headerlink href=#connect-as-a-specific-user title="Permanent link">&para;</a></h4> <p>You can specify a user on the command line. Ensure the KUBECONFIG environment variable is not set, then login using:</p> <div class=highlight><pre><span></span><code>oc<span class=w> </span>login<span class=w> </span>-u<span class=w> </span>&lt;user&gt;<span class=w> </span>--server<span class=o>=</span>https://api.&lt;cluster<span class=w> </span>name&gt;.&lt;base<span class=w> </span>domain&gt;:6443
</code></pre></div> <p>If you are logged into the web console as the user you wish to use on the command line, then you can get the login command using the drop down menu shown when you click your username in the top menu. Select <strong>Copy login command</strong> from the menu, you will be prompted for your password, then you can select <strong>Display Token</strong> to see a login command. This uses a generated token rather than your username and password.</p> <h2 id=post-install-tasks>Post install tasks<a class=headerlink href=#post-install-tasks title="Permanent link">&para;</a></h2> <div class="admonition info"> <p class=admonition-title>Info</p> <p>If you are getting warnings that your cluster is unable to retrieve available updates because <code>https://origin-release.svc.ci.openshift.org</code> host cannot be found, then you have an out of date URL in the update service. You can fix this by running the following command as an admin user on the command line:</p> <div class=highlight><pre><span></span><code>oc patch clusterversion/version --patch &#39;{&quot;spec&quot;:{&quot;upstream&quot;:&quot;https://amd64.origin.releases.ci.openshift.org/graph&quot;}}&#39; --type=merge
</code></pre></div> </div> <h3 id=adding-an-identity-provider>Adding an Identity provider<a class=headerlink href=#adding-an-identity-provider title="Permanent link">&para;</a></h3> <p>You need a system to authenticate users to the system. OKD supports a number of different options for authenticating users. Here we will use the basic htpasswd authentication method, which is a simple list of users with encrypted passwords, held in a Kubernetes secrets object. Details of other authentication methods can be found in the <a href=https://docs.okd.io/latest/authentication/understanding-identity-provider.html target=_blank>OKD documentation</a></p> <p>Full instructions for the HTPasswd identity provider can be found in the <a href=https://docs.okd.io/latest/authentication/identity_providers/configuring-htpasswd-identity-provider.html target=_blank>OKD documentation</a></p> <h4 id=creating-the-users-and-passwords>Creating the users and passwords<a class=headerlink href=#creating-the-users-and-passwords title="Permanent link">&para;</a></h4> <p>You need access to the <a href=http://httpd.apache.org/docs/2.4/programs/htpasswd.html target=_blank>htpasswd</a> utility. This comes with most Linux distributions and MacOS. Windows users may need to get it from an apache HTTP server distribution.</p> <p>Create the user file and add the first user with command:</p> <div class=highlight><pre><span></span><code>htpasswd<span class=w> </span>-c<span class=w> </span>-B<span class=w> </span>-b<span class=w> </span>users.htpasswd<span class=w> </span>&lt;user_name&gt;<span class=w> </span>&lt;password&gt;
</code></pre></div> <p>the file <strong>users.htpasswd</strong> will be created in the current directory.</p> <p>Add additional users with command (this command expects to find file <strong>users.htpasswd</strong> in the current working directory):</p> <div class=highlight><pre><span></span><code>htpasswd<span class=w> </span>-B<span class=w> </span>-b<span class=w> </span>users.htpasswd<span class=w> </span>&lt;user_name&gt;<span class=w> </span>&lt;password&gt;
</code></pre></div> <h4 id=creating-the-secret-from-the-users-file>Creating the secret from the users file<a class=headerlink href=#creating-the-secret-from-the-users-file title="Permanent link">&para;</a></h4> <p>Once you have the users.htpasswd file created and populated with all the users you want on to be able to access the system, then you need to create a secret from the file with command (this command expects to find the <strong>users.htpasswd</strong> file in the current working directory):</p> <div class=highlight><pre><span></span><code>oc<span class=w> </span>create<span class=w> </span>secret<span class=w> </span>generic<span class=w> </span>htpass-secret<span class=w> </span>--from-file<span class=o>=</span><span class=nv>htpasswd</span><span class=o>=</span>users.htpasswd<span class=w> </span>-n<span class=w> </span>openshift-config
</code></pre></div> <h4 id=creating-identity-provider-configuration>Creating identity provider configuration<a class=headerlink href=#creating-identity-provider-configuration title="Permanent link">&para;</a></h4> <p>You can now create the identity provider using command:</p> <div class=tabbed-set data-tabs=1:2><input checked=checked id=__tabbed_1_1 name=__tabbed_1 type=radio><label for=__tabbed_1_1>Linux &amp; Mac OS</label><div class=tabbed-content> <div class=highlight><pre><span></span><code>cat<span class=w> </span><span class=s>&lt;&lt;EOF | kubectl apply -f -</span>
<span class=s>apiVersion: config.openshift.io/v1</span>
<span class=s>kind: OAuth</span>
<span class=s>metadata:</span>
<span class=s>  name: cluster</span>
<span class=s>spec:</span>
<span class=s>  identityProviders:</span>
<span class=s>  - name: my_htpasswd_provider</span>
<span class=s>    mappingMethod: claim</span>
<span class=s>    type: HTPasswd</span>
<span class=s>    htpasswd:</span>
<span class=s>      fileData:</span>
<span class=s>        name: htpass-secret</span>
<span class=s>EOF</span>
</code></pre></div> </div> <input id=__tabbed_1_2 name=__tabbed_1 type=radio><label for=__tabbed_1_2>Windows</label><div class=tabbed-content> <div class="admonition todo"> <p class=admonition-title>Todo</p> <p>Add Windows equiv of the command</p> </div> </div> </div> <h3 id=creating-an-administrator-account>Creating an administrator account<a class=headerlink href=#creating-an-administrator-account title="Permanent link">&para;</a></h3> <p>After adding the identity provider, you want to make one of the accounts added to the identity provider an administrator user. </p> <p>Before proceeding you should log into the cluster from the Web Console, using the user account you want to make an admin user.</p> <p>On the command line you can make the user an admin user with the following command (replacing <strong><user></strong> with a valid user name created for your configured identity provider):</p> <div class=highlight><pre><span></span><code>oc<span class=w> </span>adm<span class=w> </span>policy<span class=w> </span>add-cluster-role-to-user<span class=w> </span>cluster-admin<span class=w> </span>&lt;user&gt;
</code></pre></div> <h4 id=remove-the-kubeadmin-user>Remove the kubeadmin user<a class=headerlink href=#remove-the-kubeadmin-user title="Permanent link">&para;</a></h4> <p>The <strong>kubeadmin</strong> user is created during installation and should only be thought of as a temporary users. Once you have configured an identity provider and made at least one of the users an administrator on the cluster then the kubeadmin user account can be removed. Use the following command to remove the user:</p> <div class=highlight><pre><span></span><code>oc<span class=w> </span>delete<span class=w> </span>secrets<span class=w> </span>kubeadmin<span class=w> </span>-n<span class=w> </span>kube-system
</code></pre></div> </article> </div> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright © 2021 Brian Innes </div> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "..", "features": ["navigation.instant", "navigation.tracking"], "search": "../assets/javascripts/workers/search.12658920.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script> <script src=../assets/javascripts/bundle.5cf534bf.min.js></script> </body> </html>