<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="How to create your own home or office Lab environment to explore Red Hat OpenShift using oVirt and OKD"><meta name=author content="Brian Innes"><link href=https://binnes.github.io/homeLab/okd_install/ rel=canonical><link rel=icon href=../images/BrianLogo.png><meta name=generator content="mkdocs-1.2.1, mkdocs-material-7.1.8"><title>OKD install - Home Lab</title><link rel=stylesheet href=../assets/stylesheets/main.ca7ac06f.min.css><link rel=stylesheet href=../assets/stylesheets/palette.f1a3b89f.min.css><meta name=theme-color content><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style><link rel=stylesheet href=../css/extra.css></head> <body dir=ltr data-md-color-scheme=brian data-md-color-primary=brian-blue data-md-color-accent=brian-light-green> <script>function __prefix(e){return new URL("..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#okd-install class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=.. title="Home Lab" class="md-header__button md-logo" aria-label="Home Lab" data-md-component=logo> <img src=../images/BrianLogo.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Home Lab </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> OKD install </span> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query data-md-state=active required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/binnes/homeLab/ title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> homeLab </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=.. title="Home Lab" class="md-nav__button md-logo" aria-label="Home Lab" data-md-component=logo> <img src=../images/BrianLogo.png alt=logo> </a> Home Lab </label> <div class=md-nav__source> <a href=https://github.com/binnes/homeLab/ title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> homeLab </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=.. class=md-nav__link> Home </a> </li> <li class=md-nav__item> <a href=../overview/ class=md-nav__link> Overview </a> </li> <li class=md-nav__item> <a href=../preparation/ class=md-nav__link> Preparing </a> </li> <li class=md-nav__item> <a href=../ovirt/ class=md-nav__link> oVirt setup </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> OKD install <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> OKD install </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#preparing-required-information class=md-nav__link> Preparing required information </a> </li> <li class=md-nav__item> <a href=#install-okd class=md-nav__link> Install OKD </a> <nav class=md-nav aria-label="Install OKD"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#download-the-installer class=md-nav__link> Download the installer </a> </li> <li class=md-nav__item> <a href=#create-the-install-config class=md-nav__link> Create the install config </a> </li> <li class=md-nav__item> <a href=#run-the-installer class=md-nav__link> Run the installer </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#connecting-to-the-cluster class=md-nav__link> Connecting to the cluster </a> <nav class=md-nav aria-label="Connecting to the cluster"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#web-ui class=md-nav__link> Web UI </a> </li> <li class=md-nav__item> <a href=#command-line class=md-nav__link> Command line </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#post-install-tasks class=md-nav__link> Post install tasks </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../resources/ class=md-nav__link> Resources </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#preparing-required-information class=md-nav__link> Preparing required information </a> </li> <li class=md-nav__item> <a href=#install-okd class=md-nav__link> Install OKD </a> <nav class=md-nav aria-label="Install OKD"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#download-the-installer class=md-nav__link> Download the installer </a> </li> <li class=md-nav__item> <a href=#create-the-install-config class=md-nav__link> Create the install config </a> </li> <li class=md-nav__item> <a href=#run-the-installer class=md-nav__link> Run the installer </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#connecting-to-the-cluster class=md-nav__link> Connecting to the cluster </a> <nav class=md-nav aria-label="Connecting to the cluster"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#web-ui class=md-nav__link> Web UI </a> </li> <li class=md-nav__item> <a href=#command-line class=md-nav__link> Command line </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#post-install-tasks class=md-nav__link> Post install tasks </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/binnes/homeLab/edit/main/docs/okd_install.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg> </a> <h1 id=okd-install>OKD Install<a class=headerlink href=#okd-install title="Permanent link">&para;</a></h1> <!--- cSpell:ignore  ovirtmgmt Fzcwo openshift ully ualified omain mkdir --> <p>When you have your oVirt environment up and running you can install OKD.</p> <h2 id=preparing-required-information>Preparing required information<a class=headerlink href=#preparing-required-information title="Permanent link">&para;</a></h2> <p>To help with the installation here is a list of information you will need during the install:</p> <table> <thead> <tr> <th>item</th> <th>description</th> </tr> </thead> <tbody> <tr> <td>Engine FQDN</td> <td>This is the Fully Qualified Domain Name of the virtual engine. This is the value you entered in step 1 in oVirt setup section <a href=../ovirt/#install-the-hosted-engine target=_blank>Install the Hosted Engine</a></td> </tr> <tr> <td>Engine user</td> <td>This should be admin</td> </tr> <tr> <td>Engine password</td> <td>This is the value entered at ovirt install time, and the password you use to access the ovirt admin console</td> </tr> <tr> <td>oVirt Cluster name</td> <td>Should be <strong>Default</strong>. This can be verified in the oVirt Administration console, select <strong>Compute</strong> from the side menu then <strong>Clusters</strong>. By default there is a single cluster defined with <strong>Default</strong> as the name</td> </tr> <tr> <td>Storage Domain</td> <td>Select the storage domain with fast storage, ideally Solid State Disk (SSD) should be used</td> </tr> <tr> <td>Network</td> <td>Select the oVirt network to place the OKD cluster hosts on. By default a single network named <strong>ovirtmgmt</strong> is created at oVirt install</td> </tr> <tr> <td>IP address for the API endpoint for the OKD cluster</td> <td>The IP address on your network you previously allocated for the OKD cluster API Endpoint</td> </tr> <tr> <td>IP address for the Ingress for the OKD cluster</td> <td>The IP address on your network you previously allocated for the OKD Cluster Ingress</td> </tr> <tr> <td>OKD Cluster base domain</td> <td>The base domain your cluster will use for all exposed endpoints - This cannot be changed after installation</td> </tr> <tr> <td>Cluster Name</td> <td>The name for the OKD cluster, this will be prepended to the base domain to form the URLs for application and API endpoints. (e.g. <code>api.&lt;cluster name&gt;.&lt;base domain&gt;</code>)</td> </tr> <tr> <td>Enter a valid Red Hat pull secret</td> <td>This is the pull secret to the Red Hat image registries where Open Shift images are stored. You don't need to use a valid pull secret as OKD does not need access to the registries, but providing a valid secret will allow Red Hat applications to be installed on the cluster. The pull secret must pass a validation check. A valid fake secret is <code>{"auths":{"fake":{"auth":"aWQ6cGFzcwo="}}}</code>. If you have a Red Hat account a valid secret can be downloaded from <a href=https://cloud.redhat.com/openshift/install/pull-secret target=_blank>here</a></td> </tr> </tbody> </table> <h2 id=install-okd>Install OKD<a class=headerlink href=#install-okd title="Permanent link">&para;</a></h2> <p>Complete the following steps to install OKD on your cluster</p> <h3 id=download-the-installer>Download the installer<a class=headerlink href=#download-the-installer title="Permanent link">&para;</a></h3> <ul> <li>To find the latest version of the OKD installer, visit the <a href=https://github.com/openshift/okd/releases target=_blank>releases</a> page and download the latest openshift-install image for the platform where you plan to run the installer from (this is typically your local laptop, but could be a virtual machine you run on the ovirt cluster). </li> <li>Expand the downloaded archive to allow access to the openshift-install binary.</li> </ul> <h3 id=create-the-install-config>Create the install config<a class=headerlink href=#create-the-install-config title="Permanent link">&para;</a></h3> <ul> <li>Open a command or terminal window and switch to the directory containing the openshift-install binary</li> <li>run command <code>./openshift-install create install-config</code><ul> <li>select oVirt as the Platform</li> <li>enter the engine <strong>F</strong>ully <strong>Q</strong>ualified <strong>D</strong>omain <strong>N</strong>ame</li> <li>accept the suggested engine username (admin@internal) by pressing enter</li> <li>enter the engine password</li> <li>accept the default Cluster name, which should be set as <strong>Default</strong> unless you have changed oVirt configuration</li> <li>select the appropriate storage domain to store the OKD cluster host disk images</li> <li>select the Network to use</li> <li>input IP address allocated to OKD cluster API endpoint</li> <li>input IP address allocated to OKD cluster Ingress</li> </ul> </li> </ul> <h3 id=run-the-installer>Run the installer<a class=headerlink href=#run-the-installer title="Permanent link">&para;</a></h3> <div class="admonition note"> <p class=admonition-title>Note</p> <p>The default install will download the required content from the internet. It is assumed that the machine running the <strong>openshift-install</strong> application and the machine hosting <strong>oVirt</strong> and the <strong>OKD</strong> cluster have a good internet connection to be able to download the required content.</p> </div> <ul> <li>create an install directory <code>mkdir install</code></li> <li>copy the configuration into the install directory - don't move it, copy it as it gets deleted during the install, so it is good to have a backup copy. <code>cp install-config.yaml install</code></li> <li>create the cluster with command <code>./openshift-install create cluster --dir=./install --log-level=info</code></li> <li>wait until the setup completes, this can take quite a while, 30-60 minutes is not uncommon</li> <li> <p>when the install completes you will see a message similar to this:</p> <div class=highlight><pre><span></span><code>INFO Install complete!                            
INFO To access the cluster as the system:admin user when using &#39;oc&#39;, run &#39;export KUBECONFIG=/Users/brian/projects/okd/4.7/install/auth/kubeconfig&#39; 
INFO Access the OpenShift web-console here: https://console-openshift-console.apps.okd.lab.home 
INFO Login to the console with user: &quot;kubeadmin&quot;, and password: &quot;xxxxx-xxxxx-xxxxx-xxxxx&quot;
</code></pre></div> </li> </ul> <h2 id=connecting-to-the-cluster>Connecting to the cluster<a class=headerlink href=#connecting-to-the-cluster title="Permanent link">&para;</a></h2> <h3 id=web-ui>Web UI<a class=headerlink href=#web-ui title="Permanent link">&para;</a></h3> <h3 id=command-line>Command line<a class=headerlink href=#command-line title="Permanent link">&para;</a></h3> <h2 id=post-install-tasks>Post install tasks<a class=headerlink href=#post-install-tasks title="Permanent link">&para;</a></h2> <div class="admonition info"> <p class=admonition-title>Info</p> <p>If you are getting warnings that your cluster is unable to retrieve available updates because <code>https://origin-release.svc.ci.openshift.org</code> host cannot be found, then you have an out of date URL in the update service. You can fix this by running the following command as an admin user on the command line:</p> <div class=highlight><pre><span></span><code>oc patch clusterversion/version --patch &#39;{&quot;spec&quot;:{&quot;upstream&quot;:&quot;https://amd64.origin.releases.ci.openshift.org/graph&quot;}}&#39; --type=merge
</code></pre></div> </div> </article> </div> </div> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../ovirt/ class="md-footer__link md-footer__link--prev" aria-label="Previous: oVirt setup" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> oVirt setup </div> </div> </a> <a href=../resources/ class="md-footer__link md-footer__link--next" aria-label="Next: Resources" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> Resources </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> Copyright © 2021 Brian Innes </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "..", "features": ["navigation.instant", "navigation.tracking"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../assets/javascripts/workers/search.b0710199.min.js", "version": null}</script> <script src=../assets/javascripts/bundle.76f349be.min.js></script> </body> </html>